
<%-
#
# CBRAIN Project
#
# Copyright (C) 2008-2012
# The Royal Institution for the Advancement of Learning
# McGill University
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
-%>

<%= error_messages_for(@tool) %>

<div class="container-fluid">
  <div class="row">
    <div class="col-xs-6">
      <div class="panel panel-primary">
        <div class="panel-heading">Tool Information <span class="pull-right glyphicon glyphicon-chevron-up clickable" data-toggle="collapse" data-target="#info-panel"></span></div>
        <div class="panel-body collapse in" id="info-panel">
          <div class="row">
            <div class="col-xs-4"><%= f.label :name, "Tool Name:" %></div>
            <div class="col-xs-8"><%= f.text_field :name, :class => "form-control" %></div>
          </div>
          <div class="row" title="PortalTask subclass which implements this tool.">
            <div class="col-xs-4"><%= f.label :cbrain_task_class_name, "CbrainTask Class name:" %></div>
            <div class="col-xs-8"><%= f.text_field :cbrain_task_class_name, :class => "form-control" %></div>
          </div>
          <div class="row">
            <div class="col-xs-4"><%= f.label :user_id, "Belongs to:" %></div>
            <div class="col-xs-8"><%= user_select "tool[user_id]", @tool, :id => 'tool_user_id', :class => "form-control" %></div>
          </div>
          <div class="row">
            <div class="col-xs-4"><%= f.label :group_id, "Available to members of project:" %></div>
            <div class="col-xs-8"><%= group_select "tool[group_id]", @tool, :id => 'tool_group_id', :class => "form-control" %></div>
          </div>
          <div class="row">
            <div class="col-xs-4"><%= f.label :category, "Category:" %></div>
            <div class="col-xs-8"><%= f.select :category, Tool::Categories, {}, { :class => "form-control" } %></div>
          </div>
          <div class="row">
            <div class="col-xs-4"><%= f.label :license_agreements, "License agreements:" %></div>
            <div class="col-xs-8">
              <%= f.text_area :license_agreements, :value => @tool.new_record? ? "" : @tool.license_agreements.join("\n") , :rows => 5, :class => "form-control" %>
              Enter one agreement name per line. Note that only alphanumeric characters, underscores (_) and dashes (-) are accepted.
            </div>
          </div>
          <div class="row">
            <div class="col-xs-4"><%= f.label :description, "Description:" %></div>
            <div class="col-xs-8">
              <%= f.text_area :description, :rows => 10, :class => "form-control" %>
              The first line must should be a short summary, and the rest are for any special notes for the users.
            </div>
          </div>
          <div class="row">
            <div class="col-xs-4"><%= f.label :application_package_name, "Package name:" %></div>
            <div class="col-xs-8"><%= f.text_field :application_package_name, :class => "form-control" %></div>
          </div>
          <div class="row">
            <div class="col-xs-4"><%= f.label :application_type, "Tool type:" %></div>
            <div class="col-xs-8"><%= f.text_field :application_type, :class => "form-control" %></div>
          </div>
          <div class="row">
            <div class="col-xs-4"><%= f.label :application_tags, "Comma separated tags:" %></div>
            <div class="col-xs-8"><%= f.text_field :application_tags, :class => "form-control" %></div>
          </div>
          <div class="row">
            <div class="col-xs-4"><%= f.label :url, "Tool URL:" %></div>
            <div class="col-xs-8"><%= f.text_field :url, :class => "form-control" %></div>
          </div>
          <div class="row">
            <div class="col-xs-4"><%= f.label :select_menu_text, "Text for select box on the userfiles page:" %></div>
            <div class="col-xs-8"><%= f.text_field :select_menu_text, :class => "form-control" %></div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xs-6">
      <% if @tool && !@tool.new_record? %>
          <div class="panel panel-primary">
            <div class="panel-heading">Deployed Tool <span class="pull-right glyphicon glyphicon-chevron-up clickable" data-toggle="collapse" data-target="#deployed-panel"></span></div>
            <div class="panel-body collapse in" id="deployed-panel">
              <div class="row">
                <div class="col-xs-12">
                  <div class="text-center">
                    <%= link_to "Edit", new_tool_config_path( :tool_id => @tool.id ) %> common configuration for all servers
                  </div>
                </div>
              </div>
              <div class="row">
                <table class="simple table table-striped table-condensed">
                  <% for bourreau in Bourreau.find_all_accessible_by_user(current_user).all %>
                    <tr>
                        <th colspan="6" class="centered">
                          <%= link_to_bourreau_if_accessible(bourreau) %>
                        </th>
                    </tr>
                    <% tcs = ToolConfig.where( :bourreau_id => bourreau.id, :tool_id => @tool.id ) %>
                    <% tcs << 'Dummy entry for "add new" row' %>
                    <% rows = tcs.size %>
                    <% tcs.each_with_index do |tc,i| %>
                      <tr class="<%= cycle("list-odd", "list-even") %>">
                        <% if i == rows - 1 %>
                          <td colspan="6">
                            <center>
                            <% if rows <= 1 %>
                              <%= html_colorize("(No specific versions configured).") %>
                            <% else %>
                              <%= pluralize(rows-1," version") + " configured." %>
                            <% end %>
                            <%= link_to "Add new", new_tool_config_path( :tool_id => @tool.id, :bourreau_id => bourreau.id ) %>
                            </center>
                          </td>
                        <% else %>
                          <td><%= overlay_description(tc.version_name + "\n" + tc.description) %></td>
                          <td><%= link_to_group_if_accessible(tc.group) %></td>
                          <td><%= pluralize((tc.ncpus || 1), "cpu") %></td>
                          <td><%= link_to "Edit", edit_tool_config_path(tc) %></td>
                          <td><%= link_to "Show", tool_config_path(tc) %></td>
                          <td><%= link_to 'Delete', tc, :confirm => "Are you sure you want to delete version configuration '#{tc.version_name}'?", :method => :delete %></td>
                        <% end %>
                      </tr>
                    <% end %>
                  <% end %>
                </table>
              </div>
            </div>
          </div>
        <% end %>
    </div>
  </div>
</div>

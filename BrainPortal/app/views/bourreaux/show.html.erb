
<%

#
# CBRAIN Project
#
# Original author: Pierre Rioux
#
# $Id$
#

-%>

<% title 'Bourreau Info' %>


<% content_for(:sidebar) do %>
  <% if @bourreau.is_alive? %>
      <p class="notice">This bourreau is alive.</p>
      <% if @info.name != @bourreau.name %>
        <p class="error">Error! The remote Bourreau's name is '<%= h(@info.name) %>' while locally it is called '<%= h(@bourreau.name) %>' !</p>
      <% end %>
  <% else %>
      <p class="error">This bourreau is NOT RESPONDING!</p>
  <% end %>
<% end %>

<h2>Information about a Bourreau</h2>


<div class = "generalcontent">

   <div class = "generalbox">

      <table>

         <tr>
           <th colspan="2">Implementation information</th>
         </tr>

         <tr>
             <th>Name</th>
             <td class="info"><%= h(@bourreau.name) %></h1>
         </tr>

         <tr>
             <th>Class</th>
             <td class="info"><%= h(@bourreau.class.to_s) %></td>
         </tr>

         <tr>
             <th>Revision Info (Bourreau Client)</th>
             <td class="info"><%= h(Bourreau.revision_info.svn_id_pretty_rev_author_date) %></td>
         </tr>

         <tr>
             <th>Description</th>
             <td class="info"><%= h(@bourreau.description) %></td>
         </tr>

         <tr>
           <th colspan="2">Access information</th>
         </tr>

         <tr>
             <th>Owner</th>
             <td class="info"><%= h(@bourreau.user.login) %></td>
         </tr>

         <tr>
             <th>Group</th>
             <td class="info"><%= h(@bourreau.group.name) %></td>
         </tr>

         <tr>
             <th>Status</th>
             <td class="info"><%= h(@bourreau.online ? "Online" : "Offline") %></td>
         </tr>

         <% if check_role(:admin) || @bourreau.user_id == current_user.id %>

             <tr>
                 <th colspan="2">ActiveResource Configuration</th>
             </tr>

             <tr>
                 <th>Host</th>
                 <td class="info"><%= h(@bourreau.actres_host) %></td>
             </tr>

             <tr>
                 <th>Port</th>
                 <td class="info"><%= h(@bourreau.actres_port) %></td>
             </tr>



             <tr>
                 <th colspan="2">SSH Remote Control Configuration</th>
             </tr>

             <tr>
                 <th>Host</th>
                 <td class="info"><%= h(@bourreau.ssh_control_host) %></td>
             </tr>

             <tr>
                 <th>User</th>
                 <td class="info"><%= h(@bourreau.ssh_control_user) %></td>
             </tr>

             <tr>
                 <th>Port</th>
                 <td class="info"><%= h(@bourreau.ssh_control_port) %></td>
             </tr>

             <tr>
                 <th>Bourreau Rails HOME</th>
                 <td class="info"><%= h(@bourreau.ssh_control_rails_dir) %></td>
             </tr>



             <tr>
                 <th colspan="2">Tunneling Configuration</th>
             </tr>

             <tr>
                 <th>Database Server Remote Tunnel Port</th>
                 <td class="info"><%= h(@bourreau.tunnel_mysql_port) %></td>
             </tr>

             <tr>
                 <th>ActiveResource Remote Tunnel Port</th>
                 <td class="info"><%= h(@bourreau.tunnel_actres_port) %></td>
             </tr>

         <% end %>

         <tr>
           <th colspan="2">Runtime Information</th>
         </tr>

         <% if ! @bourreau.is_alive? %>

             <tr>
               <td colspan="2">This Bourreau is currently <font color="red">DOWN</font>.</td>
             </tr>

         <% else %>

             <tr>
                 <th>Revision Info (Bourreau Server)</th>
                 <td class="info">
                     <strong>Subversion Revision: </strong><%= @info.revision %><br>
                     <strong>Last Change Author: </strong><%= @info.lc_author %><br>
                     <strong>Last Change Revision: </strong><%= @info.lc_rev %><br>
                     <strong>Last Change Date: </strong><%= @info.lc_date %>
                 </td>
             </tr>

             <tr>
                 <th>Number of tasks (running/max)</th>
                 <td class="info"><%= h(@info.tasks_tot + " / " + @info.tasks_max) %></td>
             </tr>

             <tr>
                 <th>Host uptime</th>
                 <td class="info"><%= h(@info.host_uptime) %></td>
             </tr>

             <tr>
                 <th>Bourreau Server uptime</th>
                 <td class="info">
                   Up since: <%= h(@info.bourreau_uptime.to_i.ago.to_s(:db)) %><br>
                   (for: <%= pretty_elapsed(@info.bourreau_uptime.to_i) %>)
                 </td>
             </tr>

             <tr>
                 <th>Bourreau Cluster Management System</th>
                 <td class="info">
                   Type: <%= h(@info.bourreau_cms) %><br>
                   Rev:  <%= h(@info.bourreau_cms_rev.svn_id_pretty_rev_author_date) %>
                 </td>
             </tr>

             <tr>
                 <th>Bourreau SSH Public Key</th>
                 <td class="info"><SMALL><SMALL><PRE><%= pretty_ssh_key(@info.ssh_public_key.strip) %><PRE></SMALL></SMALL></td>
             </tr>

         <% end %>

         <% if check_role(:admin) || @bourreau.user_id == current_user.id %>

            <tr>
               <td class="info" align="center" colspan="2">
                  <table>
                    <tr>
                      <td class="info">
                        <%= button_to 'Edit', edit_bourreau_path(@bourreau), :method => :get %>
                      </td>
                      <td class="info">
                        <%= button_to 'Delete', bourreau_path(@bourreau), :confirm => 'Are you sure?', :method => :delete %>
                      </td>
                    </tr>
                  </table>
               </td>
            </tr>

         <% end %>

      </table>

      <table>
        <tr>
          <th colspan="3">Task Statistics</th>
        </tr>
        <tr>
          <th>User</th><th>Number of Completed Tasks</th><th>Total Number Of Tasks</th>
        </tr>
        <% @user_tasks_info.each do |user, comp_tot| %>
          <tr>
            <td class="info"><%= h(user) %></td>
            <td class="info"><%= h(comp_tot[0].to_s) %></td>
            <td class="info"><%= h(comp_tot[1].to_s) %></td>
          </tr>
        <% end %>
      </table>

   </div>  <!-- End class="generalbox" -->

</div>  <!-- End class="generalcontent" -->

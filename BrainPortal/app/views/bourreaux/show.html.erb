
<%

#
# CBRAIN Project
#
# Original author: Pierre Rioux
#
# $Id$
#

-%>

<% title 'Execution Server Info' %>

<h2>Information for <%= @bourreau.name %></h2>

<%= javascript_tag "document.observe('dom:loaded', function() {$$('.#{@bourreau.class}').each(function(value, index) {value.show();});})" %>


<!-- <% isbourreau = @bourreau.is_a?(Bourreau) %> -->

<div class = "generalcontent">

<div class= "generalbox">
    
      <table>

         <tr>
           <th colspan="2">Implementation information</th>
         </tr>

         <tr>
             <th>Name</th>
             <td class="info"><%= h(@bourreau.name) %></td>
         </tr>

         <tr>
             <th>Class</th>
             <td class="info"><%= h(@bourreau.class.to_s) %></td>
         </tr>

         <tr>
             <th>Revision Info (Client Side)</th>
             <td class="info"><%= h(Bourreau.revision_info.svn_id_pretty_rev_author_date) %></td>
         </tr>

         <tr>
             <th>Description</th>
             <td class="info"><%= h(@bourreau.description) %></td>
         </tr>

         <tr>
           <th colspan="2">Access information</th>
         </tr>

         <tr>
             <th>Owner</th>
             <td class="info"><%= h(@bourreau.user.login) %></td>
         </tr>

         <tr>
             <th>Group</th>
             <td class="info"><%= h(@bourreau.group.name) %></td>
         </tr>

         <tr>
             <th>Status</th>
             <td class="info"><%= h(@bourreau.online ? "Online" : "Offline") %></td>
         </tr>

         <% if check_role(:admin) || @bourreau.user_id == current_user.id %>

         <tr>
             <th colspan="2">ActiveResource Configuration</th>
         </tr>

         <tr>
             <th>Host</th>
             <td class="info"><%= h(@bourreau.actres_host) %></td>
         </tr>

         <tr>
             <th>Port</th>
             <td class="info"><%= h(@bourreau.actres_port) %></td>
         </tr>

         <tr>
             <th colspan="2">SSH Remote Control Configuration</th>
         </tr>

         <tr>
             <th>Host</th>
             <td class="info"><%= h(@bourreau.ssh_control_host) %></td>
         </tr>

         <tr>
             <th>User</th>
             <td class="info"><%= h(@bourreau.ssh_control_user) %></td>
         </tr>

         <tr>
             <th>Port</th>
             <td class="info"><%= h(@bourreau.ssh_control_port) %></td>
         </tr>

         <tr>
             <th>Execution Server Rails HOME</th>
             <td class="info"><%= h(@bourreau.ssh_control_rails_dir) %></td>
         </tr>

        <tr>
             <th colspan="2">Tunneling Configuration</th>
         </tr>

         <tr>
             <th>Database Server Remote Tunnel Port</th>
             <td class="info"><%= h(@bourreau.tunnel_mysql_port) %></td>
         </tr>

         <tr>
             <th>ActiveResource Remote Tunnel Port</th>
             <td class="info"><%= h(@bourreau.tunnel_actres_port) %></td>
         </tr>

         <tr>
             <th colspan="2">Cache Management Configuration</th>
         </tr>

         <tr>
             <th>Cache Expiration Timeout (in seconds)</th>
             <td class="info"><%= h(@bourreau.cache_trust_expire) %></td>
         </tr>

         <% end %>

         <tr>
           <th colspan="2">Runtime Information</th>
         </tr>

         <% if @info.name == "???" %>

             <tr>
               <td colspan="2">This server is currently <font color="red">DOWN</font>.</td>
             </tr>

         <% else %>

             <tr>
                 <th>Revision Info (Server Side)</th>
                 <td class="info">
                     <strong>Subversion Revision: </strong><%= @info.revision %><br>
                     <strong>Last Change Author: </strong><%= @info.lc_author %><br>
                     <strong>Last Change Revision: </strong><%= @info.lc_rev %><br>
                     <strong>Last Change Date: </strong><%= @info.lc_date %>
                 </td>
             </tr>

             <tr>
                 <th>Host name</th>
                 <td class="info"><%= h(@info.host_name) %></td>
             </tr>

             <tr>
                 <th>Host IP address</th>
                 <td class="info"><%= h(@info.host_ip) %></td>
             </tr>

             <tr>
                 <th>Host OS type</th>
                 <td class="info"><%= h(@info.host_uname) %></td>
             </tr>

             <tr>
                 <th>Host uptime</th>
                 <td class="info"><%= h(@info.host_uptime) %></td>
             </tr>

             <tr>
                 <th>Server uptime</th>
                 <td class="info">
                   Up since: <%= h(@info.uptime.to_i.ago.to_s(:db)) %><br>
                   (for: <%= pretty_elapsed(@info.uptime.to_i) %>)
                 </td>
             </tr>

             
             <tr>
                 <th>Worker PIDs</th>
                 <td class="info"><%= @info.worker_pids %></td>
             </tr>

             <tr class="Bourreau" style="display:none">
                 <th>Worker Revision Info</th>
                 <td class="info">
                     <strong>Last Change Author: </strong><%= @info.worker_lc_author %><br>
                     <strong>Last Change Revision: </strong><%= @info.worker_lc_rev %><br>
                     <strong>Last Change Date: </strong><%= @info.worker_lc_date %>
                 </td>
             </tr>
             <tr class="Bourreau" style="display:none">
                 <th>Number of tasks (running/max)</th>
                 <td class="info"><%= h(@info.tasks_tot + " / " + @info.tasks_max) %></td>
             </tr>

             <tr class="Bourreau" style="display:none">
                 <th>Execution Server Cluster Management System</th>
                 <td class="info">
                   Type: <%= h(@info.bourreau_cms) %><br>
                   Rev:  <%= h(@info.bourreau_cms_rev.svn_id_pretty_rev_author_date) %>
                 </td>
             </tr>

             <tr>
                 <th>Execution Server SSH Public Key</th>
                 <td class="info"><SMALL><SMALL><PRE id="format_ssh_key"><%= h(@info.ssh_public_key.strip) %><PRE></SMALL></SMALL></td>
             </tr>

         <% end %>

         </table>

         <% if check_role(:admin) || @bourreau.user_id == current_user.id %>

            <tr class="Bourreau" style="display:none">
               <td class="info" align="center" colspan="2">
                  <table id ="button_table">
                    <tr>
                      <td class="info">
                        <%= button_to 'Edit', edit_bourreau_path(@bourreau), :method => :get %>
                      </td>
                      <td class="info">
                        <%= button_to 'Delete', bourreau_path(@bourreau), :confirm => 'Are you sure?', :method => :delete %>
                      </td>
                    </tr>
                  </table>
               </td>
            </tr>

         <% end %>

      <table class="Bourreau" style="display:none">
        <tr>
          <th colspan="<%= @statuses_list.size + 2 %>">Task Statistics</th>
        </tr>
        <tr>
          <th>User</th>
          <% @statuses_list.each do |stat| %>
            <th><%= h(stat) %></th>
          <% end %>
        </tr>
        <% @user_tasks_info.each do |user, statcnt| %>
          <tr>
            <td class="info"><%= h(user) %></td>
            <% @statuses_list.each do |stat| %>
              <td><%= h(statcnt[stat]) %></td>
            <% end %>
          </tr>
        <% end %>
          <tr>
            <td class="info">TOTAL</td>
            <% @statuses_list.each do |stat| %>
              <td><%= h(@statuses[stat]) %></td>
            <% end %>
          <tr>
      </table>

      <%= render :partial => "layouts/log_report", :locals  => { :log  => @log, :title => "Server Log" } %>

  </div>  <!-- End class="generalbox" -->

</div>  <!-- End class="generalcontent" -->

<tr class=" message_display_<%= mess.id %>">
  
  <td class="<%= "#{mess.message_type}_display "%>left_side wrap<%= mess.read? ? " message_read" : " message_unread" %>">
    <% if render_for == :index %>
      <%= check_box_tag("message_ids[]", mess.id.to_s, false, :class => 'messlist') %>
      </td>
      <td class="<%= "#{mess.message_type}_display " %>middle bold left<%= mess.read? ? " message_read" : " message_unread" %>">
    <% end %>
    &nbsp;
    <%= show_hide_toggle Message.parse_markup( mess.header ), "#message_table_details_#{mess.id}" %>

    <div id="message_table_details_<%= mess.id %>" class="no_wrap" style="display:none">
      <%= render :partial  => 'messages/message_details', :locals  => {:mess  => mess} %>
    </div>
  </td>
  
  <% if render_for == :index && current_user.has_role?(:admin) && @filter_params["view_all"] == "on" %>
    <td class="<%= "#{mess.message_type}_display " %>middle<%= mess.read? ? " message_read" : " message_unread" %>">
      <%= mess.user.login %>
    </td>
  <% end %>

  <td class="<%= "#{mess.message_type}_display " %>middle<%= mess.read? ? " message_read" : " message_unread" %>">
    <%= to_localtime(mess.last_sent, :datetime) %>
  </td>

  <td class="<%= "#{mess.message_type}_display "%>right_side<%= mess.read? ? " message_read" : " message_unread" %>">

    <% if mess.read %>
      <%= 
         delete_button 'Mark&nbsp;as&nbsp;Unread'.html_safe, message_path(mess, :read => "false"),
                 :class => 'action_link', 
                 :method  => "PUT",
                 :target  => ".message_display_#{mess.id}", 
                 :loading_message  => "<td colspan='4' style='color:red; text-align:center;'>Updating...</td>"
      %>
    <% else %>
      <%= 
        delete_button  'Mark&nbsp;as&nbsp;Read'.html_safe,  message_path(mess, :read  => "true"),
                 :class => 'action_link', 
                 :method  => "PUT",
                 :target  => ".message_display_#{mess.id}", 
                 :loading_message  => "<td colspan='4' style='color:red; text-align:center;'>Updating...</td>"
      %>
    <% end %>
    &nbsp;
    <%= 
       delete_button  'Delete',  message_path(mess),
                :class => 'action_link', 
                :method  => "DELETE",
                :target  => ".message_display_#{mess.id}", 
                :loading_message  => "<td colspan='4' style='color:red; text-align:center;'>Deleting...</td>"
    %>
  </td>

</tr>


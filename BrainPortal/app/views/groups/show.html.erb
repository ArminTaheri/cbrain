
<%-
#
# CBRAIN Project
#
# Copyright (C) 2008-2012
# The Royal Institution for the Advancement of Learning
# McGill University
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.  
#
-%>

<% title "Project Info" %>

<% if (@group.is_a?(WorkGroup) || @group.is_a?(InvisibleGroup)) && @group.can_be_edited_by?(current_user) %>
  <div class="menu_bar">
    <%= link_to 'Switch', {:action => :switch, :id => @group.id}, :class => "button", :method  => :post %>
    <%= link_to 'Delete', group_path(@group), { :confirm => "Are you sure you want to delete '#{@group.name}' ?", :method => :delete, :class => "button" } %>
  </div>
<% end %>

<P>

<%= error_messages_for :group, :header_message => "Project could not be updated." %>

<div class="display_inline_block" style="min-width: 50%"> 

  <%= show_table(@group, :edit_condition => @group.can_be_edited_by?(current_user)) do |t| %>

    <% t.edit_cell(:name) do %>
      <%= text_field_tag "group[name]", @group.name %>
    <% end %>

    <% t.edit_cell(:site_id, :content => link_to_site_if_accessible(@group.site), :disabled => !current_user.has_role?(:admin)) do %>
      <%= select_tag "group[site_id]", options_for_select(Site.all.map{ |s| [s.name, s.id]}, :selected => @group.site_id), :include_blank => true %>
    <% end %>

    <% t.cell("Type") { @group.pretty_category_name(current_user) } %>

    <% t.empty_cell %>

  <% end %>

  <%= show_table(@group, :header => 'Resources') do |t| %>

    <% t.cell("Files") { index_count_filter @group.userfiles.count, :userfiles, {:group_id => @group.id}, :show_zeros => true } %>

    <% t.cell("Tasks") { index_count_filter @group.cbrain_tasks.count, :tasks, {:group_id => @group.id}, :show_zeros => true } %>

    <% if current_user.has_role?(:admin) %>
      <% t.cell("Tools") { index_count_filter @group.tools.count, :tools, {:group_id => @group.id} }%>
      <% t.cell("Data Providers") { index_count_filter @group.data_providers.count, :data_providers, {:group_id => @group.id} } %>
      <% t.cell("Portal") { index_count_filter BrainPortal.where(:group_id => @group.id).count, :bourreaux, {:group_id => @group.id, :type => "BrainPortal"} } %>
      <% t.cell("Execution") { index_count_filter Bourreau.where(:group_id => @group.id).count, :bourreaux, {:group_id => @group.id, :type => "Bourreau"} } %>
    <% end %>

  <% end %>

  <%= show_table(@group, :header => 'Members', :edit_condition => @group.can_be_edited_by?(current_user)) do |t| %>

    <% default_text = array_to_table(@group.users.sort{ |a,b| a.login.casecmp(b.login)}, :table_class => 'simple bordered float_left', :cols => 20, :min_data => 20, :fill_by_columns => true ) { |u,r,c| link_to_user_with_tooltip(u) } %>

    <% t.edit_cell(:user_id, :show_width => 2,
                             :header  => 'Members',
                             :content => default_text, :show_width => 2,
                             :disabled => current_user.has_role?(:user)) do %>
      <div class="generalbox" style="width: 100%">
        <%= render :partial => 'users_form' %><br>
        <%= hidden_field_tag :update_users, true %>
      </div> 
    <% end %>

  <% end %>

</div>

<% if @group.can_be_edited_by?(current_user) %>
  <P>
  <%= render :partial => "layouts/log_report", :locals  => { :log  => @group.getlog, :title => 'Project Log' } %>
<% end %>


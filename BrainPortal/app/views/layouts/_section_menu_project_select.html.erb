<% if current_user.site %>
    <div id = "site_div">
        <h1>Site: <%= "#{current_user.site.name}" %></h1>
    </div>
<% end %>

<div id="active_project_div">
  <h1>Active Project:</h1> 
    <%= button_with_dropdown_menu((current_project ? current_project.name : "None"), :button_id  => "header_project_menu") do %>
      <div id="project_menu_items">
        <small>
          Choosing an Active Project affects the visibility of<br/>
          <em>everything</em> in the interface (files, tasks etc).<br/>
          Use this as a way to concentrate on a particular project.<br/>
        </small>
        <p/>
        
        
        <% projects = current_user.available_groups.group_by{|p| p.class.to_s == "WorkGroup" ? "WorkGroup" : "SystemGroup"} %>
        <% work_projects = (projects["WorkGroup"] || []).sort   { |a,b| a.name <=> b.name } %>
        <% sys_projects  = (projects["SystemGroup"] || []).sort { |a,b| a.name <=> b.name } %>  
        <% all_projects = work_projects + sys_projects %>
          
        <div class="group_selector">
          <%= form_tag :controller => :groups, :action => :switch do %>
            <%= group_select('id', {:groups => all_projects, :selector => current_project }, {:include_blank => "None", :class => "submit_onchange"}) %>
            <%= hidden_field_tag :redirect_controller, params[:controller] %>
            <%= hidden_field_tag :redirect_action    , params[:action]     %>
            <%= hidden_field_tag :redirect_id        , params[:id]         %>
          <% end %>
        </div>
        
      </div>          
    <% end %>
</div>




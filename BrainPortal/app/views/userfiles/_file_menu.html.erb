<div class="menu_bar">
  <span class="button_set">  

    <%= button_with_dropdown_menu("Scientific Tools")  do %>
      <%= render :partial => 'userfiles/tool_management_scientific' %>
    <% end %>

    <%= button_with_dropdown_menu("Conversion Tools")  do %>
      <%= render :partial => 'userfiles/tool_management_conversion' %>
    <% end %>

    <%= button_with_dropdown_menu("Download") do %>
      Specify Download File Name (optional):
      <%= text_field_tag :specified_filename %>
      <%= hijacker_submit_button("Download Files", :url  => url_for(:controller => 'userfiles', :action => 'download'), :ajax_submit  => false, :method  => :get) %>
    <% end %>

    <%= button_with_dropdown_menu("Update Attributes") do %>
        <h4>Tags</h4>
        <%= render :partial => 'userfiles/tag_table' %>
        <hr>
        <h4>Projects</h4>
        Change Project: 
        <%= group_select('userfile[group_id]', { :groups => @user_groups, :selector => @default_group } ) %>
        <%= hijacker_submit_button("Update Projects", :url  => url_for(:action  => :update_multiple), :method  => :put) %>
        <P>
        Project Permission Update: 
        <%= select(:userfile, :group_writable, [['Read Only', false],['Read/Write', true]]) %>
        <%= hijacker_submit_button("Update Permissions", :url  => url_for(:action  => :update_multiple), :method  => :put) %> 
        <hr>
        Update Parent-Child Relationships:
        <%= hijacker_submit_button("Update",  :url  => url_for(:action  => :new_parent_child ),
                                                     :datatype => 'html',
                                                     :overlay => true,
                                                     :method  => :get) 
        %>
        <hr>
        Update File Type:
        <%=
           select_tag :file_type, grouped_options_for_select(
             [["Files",       SingleFile.valid_file_classes.map{|c| [c.pretty_type, c.name]}],
              ["Collections", FileCollection.valid_file_classes.map{|c| [c.pretty_type, c.name]}]
             ])
         %>
        <%= hijacker_submit_button("Update", :url  => url_for(:action  => :update_multiple), :method  => :put) %> 
        <hr>
        Start QC: <%= 
                      hijacker_submit_button("Start", :url  => url_for(:controller => 'userfiles', :action => 'quality_control'), 
                                                      :confirm  => "Please note that files must be synchronized locally for QC. \n\nContinue?",
                                                      :ajax_submit  => false, 
                                                      :method  => :post) 
                  %>
        <hr>
        Cache Operations:<br/>
        <%= hijacker_submit_button("Synchronize Files Locally", :url  => url_for(:controller => 'userfiles', :action => 'sync_multiple', :operation => 'sync_local'), :ajax_submit  => false, :method  => :post) %>
        &nbsp;or&nbsp;
        <%= hijacker_submit_button("Mark Content As Newer", :url  => url_for(:controller => 'userfiles', :action => 'sync_multiple', :operation => 'all_newer'), :ajax_submit  => false, :method  => :post) %>
    <% end %>

    <%= button_with_dropdown_menu("Move/Copy", :class => 'centered') do %>
        <p>
          To Data Provider:
          <%= data_provider_select("data_provider_id") %>
        </p>
        <!-- jQuery has a bug for the following checkbox, which explains the style attribute. -->
        <p>
          Overwrite destination, if it exists:
          <input type="checkbox" name="crush_destination" value="crush" style="position: relative; left: 0;">
        <p/>
        <p>
          <%= hijacker_submit_button("Move Files", :url  => url_for(:action  => :change_provider), :method  => :post) %>
          <%= hijacker_submit_button("Copy Files", :url  => url_for(:action  => :change_provider), :method  => :post) %>
        <p/>
    <% end %>

    <% select_label = "Selected Files" + (current_session.persistent_userfile_ids.size != 0 ? " (now: #{current_session.persistent_userfile_ids.size})" : "") %>
    <%= button_with_dropdown_menu(select_label, :class => 'centered') do %>
      <p class="left_align">
      This panel manages your list of <em>persistently</em> selected files.<br/>
      This list is maintained even when you switch from page to page.<br/>
      These files plus those selected on the current page will all be used<br/>
      for all operation buttons (move/copy, submit tasks, etc).
      </p>
      <p>
      <% if current_session.persistent_userfile_ids.size == 0 %>
        Currently, no files are selected persistently.
      <% else %>
        <%= html_colorize("#{pluralize(current_session.persistent_userfile_ids.size,"file")} currently selected persistently.") %>
      <% end %>
      </p>
      <p>
      <% [ 'Add To List', 'Remove From List', 'Clear The List' ].each do |label| %>
        <%= hijacker_submit_button(label,
              :url => url_for(:action  => :manage_persistent, :operation => label),
              :method => :post,
              :ajax_submit => false
            ) 
        %>
      <% end %>
      </p>
   <% end %>

   </span>
</div>

<div class="menu_bar">
  <span class="button_set">

    <%= submit_button("Jiv Viewer", {:name => "commit", :id => "jiv_submit"}) %>

    <%= hijacker_submit_button("(Un)compress",  :url  => url_for(:action  => :compress ),
                                                :confirm => "Are you sure you want to compress or uncompress the selected files?", 
                                                :class  => "button", 
                                                :method  => :post) 
    %>

    <%= hijacker_submit_button("Create Collection", :url  => url_for(:action  => :create_collection),
                                                    :class  => "button", 
                                                    :method  => :post)
    %>

    <%= hijacker_submit_button("Delete", :url  => url_for(:action  => :delete_files),
                                         :class  => "button",
                                         :confirm => "Are you sure you want to delete the selected files?",
                                         :method  => :delete) 
    %>

  </span>
</div>

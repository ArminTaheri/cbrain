
<tr>



    <th> 
       <input type='checkbox' class="checkbox" id="header_checkbox" onclick="try {
         $$('.checkbox').each(function(value, index) {
            value.checked = $('header_checkbox').checked;
         });
         } catch (e) { alert('RJS error:\n\n' + e.toString()); alert('$$(\'.checkbox\').each(function(value, index) {\nvalue.checked = true;\n});'); throw e }; return true;"
       />
    </th>



    <th id="task_type_header" onMouseOver="$('task_filters_list').show()" onMouseOut="$('task_filters_list').hide()">
      <%= link_to_remote  "Task Name", :url  =>  {
                                         :controller  => :tasks, 
                                         :action  => :index, 
                                         :tasks  => {:sort  => {:order  => 'cbrain_tasks.type', :dir  => set_dir('cbrain_tasks.type', @filter_params["sort"])}}
                                       }, 
                                       :method  => 'get'  
      %>
      <%= set_order_icon('cbrain_tasks.type', @filter_params["sort"]["order"], @filter_params["sort"]["dir"]) %>
      <% unless @task_types.blank? %>
        <br>
        <ul class="filter_list" id="task_filters_list" style="display:none;">
           <% @task_types.sort.each do |task_type| %>
              <li><%= link_to_remote h(crop_text_to(20, task_type.sub(/^CbrainTask::/, ""))), :url  => {:controller  => :tasks, :action  => :index, :tasks => {:filters => {:type  => task_type}}}, :method  => 'get' %> </li> 
           <% end %>
         </ul>
      <% end %>
    </th>



    <th onMouseOver="$('description_filters_list').show()" onMouseOut="$('description_filters_list').hide()">
       <%= link_to_remote  "Description", :url  =>  {
                                             :controller  => :tasks, 
                                             :action  => :index, 
                                             :tasks  => {:sort  => {:order  => 'cbrain_tasks.description', :dir  => set_dir('cbrain_tasks.description', @filter_params["sort"])}}
                                           }, 
                                           :method  => 'get'
       %>
        <%= set_order_icon('cbrain_tasks.description', @filter_params["sort"]["order"], @filter_params["sort"]["dir"]) %>
        <% unless @task_descriptions.blank? %>
         <br>
           <ul class="filter_list" id="description_filters_list" style="display:none;">
              <% @task_descriptions.sort.each do |task_desc| %>
                 <li><%= link_to_remote h(crop_text_to(40, task_desc)), :url  => {:controller  => :tasks, :action  => :index, :tasks => {:filters => {:description  => task_desc}}}, :method  => 'get' %> </li> 
              <% end %>
            </ul>
         <% end  %>
    </th>



    <th onMouseOver="$('owner_filters_list').show()" onMouseOut="$('owner_filters_list').hide()">
       <%= link_to_remote  "Owner", :url  =>  {
                                       :controller  => :tasks, 
                                       :action  => :index, 
                                       :tasks  => {:sort  => {:order  => 'users.login', :dir  => set_dir('users.login', @filter_params["sort"])}}
                                     }, 
                                     :method  => 'get'  
       %>
       <%= set_order_icon('users.login', @filter_params["sort"]["order"], @filter_params["sort"]["dir"]) %>
       <% if current_user.has_role?(:admin) && !@task_owners.blank? %>
         <br>
           <ul class="filter_list" id="owner_filters_list" style="display:none;">
              <% @task_owners.sort_by(&:login).each do |task_owner| %>
                 <li><%= link_to_remote h(task_owner.login), :url  => {:controller  => :tasks, :action  => :index, :tasks => {:filters => {:user_id  => task_owner.id}}}, :method  => 'get' %> </li> 
              <% end %>
           </ul>
        <% end %>
    </th>



    <% unless current_project %>
      <th>
       Project
      </th>
    <% end %>



    <th onMouseOver="$('bourreau_filters_list').show()" onMouseOut="$('bourreau_filters_list').hide()">
      <%= link_to_remote  "Execution Server", :url  =>  {
                                                :controller  => :tasks, 
                                                :action  => :index, 
                                                :tasks  => {:sort  => {:order  => 'remote_resources.name', :dir  => set_dir('remote_resources.name', @filter_params["sort"])}}
                                              }, 
                                              :method  => 'get'  
      %>
      <%= set_order_icon('remote_resources.name', @filter_params["sort"]["order"], @filter_params["sort"]["dir"]) %>
      <% unless @bourreaux.blank? %>
         <br>
           <ul class="filter_list" id="bourreau_filters_list" style="display:none;">
              <% @bourreaux.sort_by(&:name).each do |bourreau| %>
                 <li><%= link_to_remote h(bourreau.name), :url  => {:controller  => :tasks, :action  => :index, :tasks => {:filters => {:bourreau_id  => bourreau.id}}}, :method  => 'get' %> </li> 
              <% end %>
           </ul>
      <% end %>
    </th>



    <th onMouseOver="$('status_filters_list').show()" onMouseOut="$('status_filters_list').hide()">
       <%= link_to_remote  "Current Status", :url  =>  {
                                               :controller  => :tasks, 
                                               :action  => :index, 
                                               :tasks  => {:sort  => {:order  => 'cbrain_tasks.status', :dir  => set_dir('cbrain_tasks.status', @filter_params["sort"])}}
                                             }, 
                                             :method  => 'get'  
       %>
       <%= set_order_icon('cbrain_tasks.status', @filter_params["sort"]["order"], @filter_params["sort"]["dir"]) %>
       <% unless @task_status.blank? %>
         <br>
           <ul class="filter_list" id="status_filters_list" style="display:none;">
              <% @task_status.sort.each do |task_status| %>
                 <li><%= link_to_remote h(task_status), :url  => {:controller  => :tasks, :action  => :index, :tasks => {:filters => {:status  => task_status}}}, :method  => 'get' %> </li> 
              <% end %>
           </ul>
       <% end %>
    </th>



    <th>
      <%= link_to_remote  "Time Submitted", :url  =>  {
                                              :controller  => :tasks, 
                                              :action  => :index, 
                                              :tasks  => {:sort  => {:order  => 'cbrain_tasks.created_at', :dir  => set_dir('cbrain_tasks.created_at', @filter_params["sort"])}}
                                            }, 
                                            :method  => 'get'  
      %>
      <%= set_order_icon('cbrain_tasks.created_at', @filter_params["sort"]["order"], @filter_params["sort"]["dir"]) %>
    </th>



    <th>
      <%= link_to_remote  "Last Updated", :url  =>  {
                                          :controller  => :tasks, 
                                          :action  => :index, 
                                          :tasks  => {:sort  => {:order  => 'cbrain_tasks.updated_at', :dir  => set_dir('cbrain_tasks.updated_at', @filter_params["sort"])}}
                                        }, 
                                        :method  => 'get'  
      %>
      <%= set_order_icon('cbrain_tasks.updated_at', @filter_params["sort"]["order"], @filter_params["sort"]["dir"]) %>
    </th>

</tr>



<% if @filter_params["sort"]["order"] == 'cbrain_tasks.launch_time DESC, cbrain_tasks.created_at' %>
  <%= render :partial => 'tasks/batch_view'  %>
<% else %>
  <%= render :partial => 'tasks/list_view' %>
<% end %>
        
<% if @tasks.blank? %>
  <tr class="list-odd"><td colspan="<%= 8 + (current_project ? 0 : 1) %>">There are no tasks in this list.</td></tr>
<% end %>


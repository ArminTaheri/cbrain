
<%

#
# CBRAIN Project
#
# Original author: Pierre Rioux
#
# $Id$
#

-%>

<% title 'Tasks' %>

<div class = "generalcontent">
     <div class = 'help_button_drop_down'>
         <% button_with_dropdown_menu(:title => "Help") do %>
            <a class = "overlay_link" data-url = "/doc/tasks/task_info.html">Task Info</a>
         <% end %>     
     </div>
  
<% form_tag(url_for(:controller => 'tasks', :action => 'operation'), :method => :post) do %>
  
      <div id="main_task_content">
          <div class = "resource_list_upper_form">
          <br>        
                 <%= select_tag( "operation",

                    <<-"OPTIONS_FOR_TASKS"
                    <option value="">Operations on selected tasks:</option>
                  
                    <optgroup label="Operations for queued tasks">
                    <option value="hold">Hold queued tasks</option>
                    <option value="release">Release held tasks</option>
                  
                    <optgroup label="Operations for running tasks">
                    <option value="suspend">Suspend running tasks</option>
                    <option value="resume">Resume suspended tasks</option>
                  
                    <optgroup label="Operations for failed tasks">
                    <option value="recover">Trigger failure recovery code</option>

                    <optgroup label="Operations for completed tasks">
                    <option value="restart_setup">Restart tasks at "Setup" stage</option>
                    <option value="restart_cluster">Restart tasks at "Cluster" stage</option>
                    <option value="restart_postprocess">Restart tasks at "Post Processing" stage</option>

                    <optgroup label="Operations for all tasks">
                    <option value="duplicate">Duplicate selected tasks and start them anew</option>
                    <option value="terminate">Terminate selected tasks</option>
                    <option value="delete">Remove selected tasks</option>
                    OPTIONS_FOR_TASKS

                    ) %>
            
                    <%= submit_tag("Apply Operation") %>
              <br>
        </div>  <!-- End class="resource_list_box" -->

        <%= link_to_function "Show Filters",  {:class  => 'action_link', :id => 'filter_option_show'} do |page|
              page['side_filter_menu_wrapper'].visual_effect(:blind_down, :duration  => 0.2)
              page['filter_option_show'].hide
              page['filter_option_hide'].show
            end
        %>

        <%= link_to_function "Hide Filters",  {:class  => 'action_link', :id => 'filter_option_hide', :style  => 'display:none;'} do |page|
              page['side_filter_menu_wrapper'].visual_effect(:blind_up, :duration  => 0.2)
              page['filter_option_hide'].hide
              page['filter_option_show'].show
            end
        %>
        <div id="side_filter_menu_wrapper" style="display:none;">
          <div id="side_filter_menu">
           <h3>
              Filters<br> 
              <small><small><small><%= link_to 'Create Custom Filter', new_custom_filter_path(:type  => 'task') %></small></small></small><br>
           </h3>
           <ul>
           <% TaskCustomFilter.all(:conditions  =>  {:user_id  => current_user.id}).each do |filter| %>
           <li>
           <%= link_to_remote crop_text_to(15, filter.name), :url  => {:action  => :index, :tasks => {:filters  => {:custom_filter  => filter.id}}},
                                           :method  => 'get',
                                           :complete  => "$('filter_option_show').show(); $('filter_option_hide').hide();  $('side_filter_menu_wrapper').hide();" 
            %>
            <br>
           <small><small>
              <%= link_to 'Edit', edit_custom_filter_path(filter) %> 
              <%= link_to 'Delete', filter, :confirm => "Are you sure you want to delete filter '#{filter.name}'?", :method => :delete %>  
           </small></small>
           </li>
           <% end %>
           </ul>
          </div>
        </div>   <!-- End id="side_filter_menu_wrapper" -->
        
        <table class = "resource_list" id="tasks_table">
          <%= render :partial => "tasks_table" %>
        </table>
      </div>
   </div>  <!-- End class="generalcontent" -->
<% end %>  <!-- End form -->




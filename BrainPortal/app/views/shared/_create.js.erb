<% if eval("@#{model_name}").errors.empty? %>
  <%= render :partial  => "shared/flash_update" %>
  var new_row = jQuery("<%= escape_javascript(render :partial => "#{model_name.pluralize}/#{model_name}_table_row", :locals  => eval("{:#{model_name}  => @#{model_name}}")) %>");
  jQuery('#<%= model_name %>_table').append(new_row);
  new_row.trigger("new_content");
  jQuery("#errorExplanation").remove();
  jQuery(".fieldWithErrors").removeClass("fieldWithErrors");
  jQuery('#new_<%= model_name %>_button').click();
<% else %>
    jQuery('#new_<%= model_name %>').html("<%= escape_javascript(render :partial  => "#{model_name.pluralize}/new") %>");
<% end %>

  
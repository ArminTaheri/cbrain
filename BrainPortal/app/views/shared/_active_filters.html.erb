<%-
#
# CBRAIN Project
#
# Copyright (C) 2008-2012
# The Royal Institution for the Advancement of Learning
# McGill University
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
-%>

<%
  return if scope.blank? || (
    scope.filters.blank? &&
    scope.custom[:custom_filters].blank?
  )
%>

<div class="active_status">
  <span class="active_status_left_side">
    <span class="active_label">Active Filters</span>
    (<%=
      scope_filter_link('clear',
        scope, :clear, nil,
        options: { :ajax => true }
      )
    %>)
    <span id="current_filters">
      <% scope.filters.each do |filter| %>
        <span class="current_filters_item">
          <%= crop_text_to(30, pretty_scope_filter(filter, model: model)) %>
        </span>
        <%=
          scope_filter_link(delete_icon,
            scope, :remove, filter,
            options: { :ajax => true }
          )
        %>
      <% end %>
      <% Array(scope.custom[:custom_filters]).each do |id| %>
        <span class="current_filters_item">
          <%= crop_text_to(30, UserfileCustomFilter.find(id).name) %>
        </span>
        <%=
          ajax_link(
            delete_icon,
            url_for(
              scope_custom_params(scope, { 'custom_filters' => [id] })
                .merge({ '_scope_mode' => 'delete' })
            ),
            :class    => 'action_link',
            :datatype => :script
          )
        %>
      <% end %>
    </span>
  </span>
</div>
